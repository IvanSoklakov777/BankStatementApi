<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	  autoReload="true" internalLogLevel="info" internalLogFile="/tmp/BankStatementApi/internalLog.txt">
  <extensions>
    <add assembly="NLog.Web.AspNetCore" />
  </extensions>
  <targets>
    <!-- CREATE SCRIPT
CREATE TABLE "Log" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "LogDate" text NOT NULL,
    "Host" text NOT NULL,
    "AppName" text NOT NULL,
    "Level" character varying(5) NULL,
    "Logger" text NULL,
    "CallSite" text NULL,
    "Message" text NULL,
    "Exception" text NULL,
    "StackTrace" text NULL,
    "EventProperties" text NULL,
    CONSTRAINT "PK_Log" PRIMARY KEY ("Id"))
			-->
    <!-- Запись лога в БД-->
    <target name="Database" xsi:type="Database" dbProvider="Npgsql.NpgsqlConnection, Npgsql"
				connectionString="${configsetting:item=ConnectionStrings.DefaultConnection}"
		        commandText="insert into &quot;Log&quot; (&quot;LogDate&quot;, &quot;Host&quot;, &quot;AppName&quot;, &quot;Level&quot;, 
				&quot;Message&quot;, &quot;Logger&quot;, &quot;CallSite&quot;, &quot;Exception&quot;, &quot;StackTrace&quot;, &quot;EventProperties&quot;)
				values (@LogDate, @Host, @AppName, @Level, @Message, @Logger, @CallSite, @Exception, @StackTrace, @EventProperties);">
      <parameter name="@LogDate" layout="${date}" dbType="NpgsqlDbType.Text" allowDbNull="false"/>
      <parameter name="@Host" layout="${hostname}" dbType="NpgsqlDbType.Text" allowDbNull="false"/>
      <parameter name="@AppName" layout="${iis-site-name}" dbType="NpgsqlDbType.Text" allowDbNull="false"/>
      <parameter name="@Level" layout="${level:format=Name}" dbType="NpgsqlDbType.Text" allowDbNull="true" size="5"/>
      <parameter name="@Logger" layout="${logger}" dbType="NpgsqlDbType.Text" allowDbNull="true"/>
      <parameter name="@CallSite" layout="${callsite:filename=true}" dbType="NpgsqlDbType.Text" allowDbNull="true"/>
      <parameter name="@Message" layout="${message}" dbType="NpgsqlDbType.Text" allowDbNull="true"/>
      <parameter name="@Exception" layout="${exception:format=tostring:maxInnerExceptionLevel=16}" dbType="NpgsqlDbType.Text" allowDbNull="true"/>
      <parameter name="@Stacktrace" layout="${stacktrace}" dbType="NpgsqlDbType.Text" allowDbNull="true"/>
      <parameter name="@EventProperties" layout="${all-event-properties}" dbType="NpgsqlDbType.Text" allowDbNull="true"/>
    </target>

    <!-- Запись лога в файл-->
    <!-- <target xsi:type="File" name="alldata" fileName="/tmp/BankStatmentApi/log.log" 
				layout="${longdate}|${event-properties:item=EventId_Id}|${uppercase:${level}}|${logger}|${message} ${exception:format=tostring}" />-->
  </targets>
  <!-- rules to map from logger name to target -->
  <rules>
    <logger name="*" minlevel="Warning" writeTo="Database"/>
    <!--<logger name="*" minlevel="Trace" writeTo="alldata" />-->
    <!--Skip non-critical Microsoft logs and so log only own logs-->
    <logger name="Microsoft.*" maxLevel = "Info" final = "true" />
  </rules>
</nlog>